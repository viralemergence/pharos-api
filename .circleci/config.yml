version: 2.1

credentials: &credentials
  - AWS Credentials

orbs:
  sam: circleci/aws-sam-serverless@3.2.0

workflows:
  version: 2
  build:
    jobs:
      # dev
      - run:
          name: Set AWS Region
          command: AWS_REGION=us-east-2

      - sam/deploy:
          context: *credentials
          stack-name: pharos-api-dev
          parameter-overrides: CorsAllow=https://dev-pharos-frontend.talusanalytics.com
          template: ./template.yaml
          aws-region: ${AWS_REGION}
          filters:
            branches:
              only:
                - dev
