version: 2.1

credentials: &credentials
  - AWS Credentials

orbs:
  sam: circleci/aws-sam-serverless@3.2.0

workflows:
  version: 2
  build:
    jobs:
      # dev
      - deploy:
          config-env: dev
          context: *credentials
          filters:
            branches:
              only:
                - dev

jobs:
  deploy:
    working_directory: ~/repo

    docker:
      - image: cimg/node:lts

    parameters:
      config-env:
        type: string

    executor: sam/default

    steps:
      - checkout
      - sam/install
      - run: sam deploy --config-env <<parameters.config-env>>
